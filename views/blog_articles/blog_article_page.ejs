<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= article.title %> | TaiwanMe Blog</title>
    <link rel="icon" href="/image/logo.png" type="image/png">
    <link rel="stylesheet" href="/style.css">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <style>
        /* ========================================= */
        /* 1. Banner Section (Âõ∫ÂÆöÂúñÁâáËàáÊØî‰æã)        */
        /* ========================================= */
        .article-banner {
            width: 100%;
            position: relative;
            aspect-ratio: 1024 / 242; /* Âõ∫ÂÆöÊØî‰æã */
            min-height: 200px;
            background-image: url('/image/blog/article_banner.jpg'); /* Âõ∫ÂÆö Banner */
            background-size: cover;
            background-position: center;
            margin-bottom: 50px;
        }

        /* Êó•ÊúüÊ®ôÁ±§ (Âè≥‰∏ãËßí + Â∫ïËâ≤) */
        .banner-date-tag {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 2;
            background-color: rgba(0, 0, 0, 0.6); 
            color: #fff;
            padding: 6px 16px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.95rem;
            letter-spacing: 1px;
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        /* ========================================= */
        /* 2. Main Layout                            */
        /* ========================================= */
        .blog-container {
            max-width: 900px;
            margin: 0 auto 100px;
            padding: 0 20px;
        }

        .blog-header { text-align: center; margin-bottom: 40px; }
        .blog-title {
            font-family: var(--font-main);
            font-size: 2.8rem;
            font-weight: 900;
            color: #333;
            margin: 0 0 20px;
            line-height: 1.3;
        }
        .blog-intro {
            font-size: 1.1rem; line-height: 1.8; color: #666; margin-bottom: 30px; text-align: justify;
        }

        /* ========================================= */
        /* 3. Map Section                            */
        /* ========================================= */
        .map-section-wrapper {
            margin-bottom: 60px; border: 1px solid #ddd; padding: 10px; background: #fff; box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        .map-label {
            font-size: 0.9rem; font-weight: bold; color: #333; margin-bottom: 10px; display: flex; align-items: center; gap: 5px; text-transform: uppercase; letter-spacing: 1px;
        }
        #blogMap { width: 100%; height: 450px; z-index: 1; background: #eee; }

        /* ========================================= */
        /* 4. Spots Content                          */
        /* ========================================= */
        .spot-block {
            margin-bottom: 80px; padding-bottom: 40px; border-bottom: 1px dashed #ddd;
        }
        .spot-block:last-child { border-bottom: none; }

        .spot-heading { display: flex; align-items: baseline; margin-bottom: 20px; }
        .spot-index {
            font-size: 2.5rem; font-weight: 900; color: #eee; margin-right: 15px; line-height: 1; font-family: serif; -webkit-text-stroke: 1px #ccc;
        }
        .spot-name { font-size: 1.8rem; font-weight: 700; color: #222; margin: 0; }

        .spot-location-tag {
            display: inline-block; background: #f4f4f4; color: #666; padding: 4px 10px; border-radius: 4px; font-size: 0.8rem; margin-bottom: 15px; font-weight: bold;
        }

        .spot-img {
            width: 100%; height: auto; border-radius: 4px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 10px; display: block;
        }

        /* ‚úÖ Êñ∞Â¢ûÔºöÂúñÁâáÁâàÊ¨äË™™ÊòéÊ®£Âºè */
        .img-credit {
            font-size: 0.75rem;
            color: #999;
            text-align: right;
            margin-bottom: 20px;
            font-style: italic;
        }
        .img-credit a {
            color: #888;
            text-decoration: none;
            border-bottom: 1px dotted #ccc;
        }
        .img-credit a:hover { color: var(--accent-color); border-bottom-color: var(--accent-color); }

        .spot-desc { font-size: 1.05rem; line-height: 1.8; color: #444; text-align: justify; }

        .spot-link {
            display: inline-block; margin-top: 15px; color: var(--accent-color); font-weight: bold; text-decoration: none; border-bottom: 2px solid var(--accent-color); transition: all 0.3s;
        }
        .spot-link:hover { background-color: var(--accent-color); color: #fff; padding: 2px 5px; }

        @media (max-width: 768px) {
            .blog-title { font-size: 2rem; }
            .spot-index { font-size: 2rem; }
            .spot-name { font-size: 1.5rem; }
            #blogMap { height: 350px; }
        }
    </style>
</head>
<body>
    <%- include('../partials/header') %>

    <div class="article-banner">
        <div class="banner-date-tag">
            <%= article.date || new Date().getFullYear() + '.01.01' %>
        </div>
    </div>

    <main class="blog-container">
        
        <header class="blog-header">
            <h1 class="blog-title"><%= article.title %></h1>
            <% if (article.intro) { %>
                <p class="blog-intro"><%= article.intro %></p>
            <% } %>
        </header>

        <div class="map-section-wrapper">
            <div class="map-label">üó∫Ô∏è Explore the Locations</div>
            <div id="blogMap"></div>
        </div>

        <div class="spots-list">
            <% if (article.spots && article.spots.length > 0) { %>
                <% article.spots.forEach((spot, index) => { %>
                    <article class="spot-block" id="spot-<%= index %>">
                        <div class="spot-heading">
                            <span class="spot-index"><%= (index + 1).toString().padStart(2, '0') %></span>
                            <h2 class="spot-name"><%= spot.name %></h2>
                        </div>
                        
                        <% if (spot.city) { %>
                            <div class="spot-location-tag">üìç <%= spot.city %></div>
                        <% } %>

                        <% if (spot.image) { %>
                            <img src="<%= spot.image %>" alt="<%= spot.name %>" class="spot-img" onerror="this.src='https://placehold.co/800x500/eee/333?text=TaiwanMe'">
                            
                            <% if (spot.author) { %>
                                <div class="img-credit">
                                    Photo by 
                                    <% if (spot.authorLink) { %>
                                        <a href="<%= spot.authorLink %>" target="_blank" rel="nofollow"><%= spot.author %></a>
                                    <% } else { %>
                                        <%= spot.author %>
                                    <% } %>
                                    
                                    <% if (spot.license) { %>
                                        / 
                                        <% if (spot.licenseLink) { %>
                                            <a href="<%= spot.licenseLink %>" target="_blank" rel="nofollow"><%= spot.license %></a>
                                        <% } else { %>
                                            <%= spot.license %>
                                        <% } %>
                                    <% } %>

                                    <% if (spot.via) { %>
                                        (<%= spot.via %>)
                                    <% } %>
                                </div>
                            <% } %>
                        <% } %>

                        <p class="spot-desc"><%= spot.description %></p>

                        <% if (spot.mapLink) { %>
                            <a href="<%= spot.mapLink %>" target="_blank" class="spot-link">View on Google Maps ‚ûú</a>
                        <% } %>
                    </article>
                <% }) %>
            <% } else { %>
                <p style="text-align:center; color:#999;">Content is being curated.</p>
            <% } %>
        </div>

    </main>

    <%- include('../partials/footer') %>
    <script src="/script.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var mapElement = document.getElementById('blogMap');
            if (mapElement) {
                var map = L.map('blogMap').setView([23.6, 120.9], 7);
                L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                    attribution: '&copy; OpenStreetMap &copy; CARTO',
                    subdomains: 'abcd',
                    maxZoom: 19
                }).addTo(map);

                var markers = [];
                <% if (article.spots && article.spots.length > 0) { %>
                    <% article.spots.forEach(function(spot, index) { %>
                        <% if (spot.coords) { %>
                            var marker = L.marker([<%= spot.coords[0] %>, <%= spot.coords[1] %>])
                                .addTo(map)
                                .bindPopup(`
                                    <div style="text-align:center;">
                                        <strong><%= spot.name %></strong><br>
                                        <a href="#spot-<%= index %>" style="color:#E8A2A2; font-weight:bold; text-decoration:none;">Read More</a>
                                    </div>
                                `);
                            markers.push(marker);
                        <% } %>
                    <% }); %>
                <% } %>

                if (markers.length > 0) {
                    var group = new L.featureGroup(markers);
                    map.fitBounds(group.getBounds().pad(0.2));
                }
            }
        });
    </script>
</body>
</html>